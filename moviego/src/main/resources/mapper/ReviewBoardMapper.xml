<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.global.moviego.mapper.ReviewBoardMapper">

	<!-- 게시글 검색 -->
  <select id="getReviewSearch" resultType="com.global.moviego.domain.ReviewBoardVO">
        SELECT review_id,
               user_id,
               rating,
               title,
               movie_id,
               movie_nm,
               poster_url,
               comment,
               read_cnt,
               created_at
        FROM tb_reviews
        WHERE 
            <choose>
                <when test="searchOption == 'title'">
                    title LIKE CONCAT('%', #{keyword}, '%')
                </when>
                <when test="searchOption == 'movie_nm'">
                    movie_nm LIKE CONCAT('%', #{keyword}, '%')
                </when>
            </choose>
        ORDER BY created_at DESC
    </select>

	<!-- 게시글 등록 -->
	<insert id="insert">
		insert into tb_reviews (
		title
		,rating
		,comment
		,created_at
		) values(
		#{title}
		,#{rating}
		,#{comment}
		,now()
		)
	</insert>

	<!-- 게시글 pageCnt 만큼(10) 조회 -->
	<select id="getFreeBoard"
		resultType="com.global.moviego.domain.ReviewBoardVO">
		select review_id
		,user_id
		,rating
		,title
		,movie_id
		,movie_nm
		,poster_url
		,comment
		,read_cnt
		,created_at
		
		from tb_reviews
		order by review_id desc
		limit 1,10
		<!-- #{pageCnt} -->
	</select>
	
	<!-- 게시판 페이징 -->
	<select id="getTotal" resultType="Integer">
		SELECT COUNT(*)
		FROM tb_reviews
	</select>
	




	<!-- 삭제 요청 <delete id="delete"> delete tb_reviews where review_id = #{reviewId} 
		</delete> -->

	<!-- 수정 <update id="update"> update tb_reviews set title= #{title}, content=#{content}, 
		writer = #{writer}, updateDate = now() where review_id = #{reviewId} </update> -->




	<!-- <select id="selectReviewCnt" resultType="Integer"> SELECT count(*) 
		FROM tb_reviews </select> -->

	<!-- 게시글 조회 -->
<!-- 	<select id="selectReview"
		resultType="com.global.moviego.domain.ReviewBoardVO">
		SELECT review_id
		,user_id
		,rating
		,title
		,movie_id
		,movie_nm
		,poster_url
		,comment
		,read_cnt
		,created_at
		FROM tb_reviews
		ORDER BY review_id DESC
	</select> -->

</mapper>